var taughtedChart=c3.generate({bindto:"#taughtedChart",data:{types:{Rate:"bar"},columns:[],colors:{Rate:"#49A5F8"}},axis:{x:{label:{text:"Quizzes",position:"outer-right"},type:"category"},y:{label:{text:"Accuracy Rate(%)",position:"outer-top"}}},grid:{y:{show:!0}}}),studentChart=c3.generate({bindto:"#studentChart",data:{types:{Number:"bar"},columns:[],colors:{Number:"#49A5F8"}},axis:{x:{label:{text:"Accuracy Rate(%)",position:"outer-right"},type:"category",categories:["<60%","60%-80%",">80%"]},y:{label:{text:"Number of Students (total: 0)",position:"outer-top"},tick:{format:function(e){return e%1==0?e:""}}}},grid:{y:{show:!0}}}),classId=$("#classId").val();$(function(){getLessonTaughtedRecord();var e=!1,t=!1,r=!1,o=!1,a=!1,i=!1,n=function(e,t){var i,n;summary.sort((i=e,n=t,function(e,t){var r=e[i],o=t[i];"accuracyRate"==i&&(r=parseFloat(e[i]),o=parseFloat(t[i]));var a=0;return a=o<r?1:-1,n?a:-a})),console.log(summary),tblRecord.html("");for(var r=0;r<summary.length;r++)appendRecord(summary[r])};$(".sort-by-name").on("click",function(){e?($(this).find(".el-icon-caret-top").addClass("active").siblings().removeClass("active"),n("username",e=!1)):($(this).find(".el-icon-caret-bottom").addClass("active").siblings().removeClass("active"),n("username",e=!0))}),$(".sort-by-no").on("click",function(){t?($(this).find(".el-icon-caret-top").addClass("active").siblings().removeClass("active"),n("studentNo",t=!1)):($(this).find(".el-icon-caret-bottom").addClass("active").siblings().removeClass("active"),n("studentNo",t=!0))}),$(".sort-by-rate").on("click",function(){r?($(this).find(".el-icon-caret-top").addClass("active").siblings().removeClass("active"),n("accuracyRate",r=!1)):($(this).find(".el-icon-caret-bottom").addClass("active").siblings().removeClass("active"),n("accuracyRate",r=!0))}),$(".sort-by-right").on("click",function(){o?($(this).find(".el-icon-caret-top").addClass("active").siblings().removeClass("active"),n("rightCount",o=!1)):($(this).find(".el-icon-caret-bottom").addClass("active").siblings().removeClass("active"),n("rightCount",o=!0))}),$(".sort-by-wrong").on("click",function(){a?($(this).find(".el-icon-caret-top").addClass("active").siblings().removeClass("active"),n("wrongCount",a=!1)):($(this).find(".el-icon-caret-bottom").addClass("active").siblings().removeClass("active"),n("wrongCount",a=!0))}),$(".sort-by-empty").on("click",function(){i?($(this).find(".el-icon-caret-top").addClass("active").siblings().removeClass("active"),n("emptyCount",i=!1)):($(this).find(".el-icon-caret-bottom").addClass("active").siblings().removeClass("active"),n("emptyCount",i=!0))}),$("#sendEmail").on("click",function(){$("#emailInput").val(""),$(".el-message-box__wrapper , .v-modal").show()}),$(".sendMessage").on("click",function(){$.post("/api/record/sendEmail",{email:$("#emailInput").val(),content:'<div class="recordWrapper taughted-record">'+$(".record-container").html()+'</div><style>.displayFlex{display:flex;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex}.notselect{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none}.recordWrapper{max-width:1200px;height:auto;margin:0 auto;background-color:#fff}.my-record{padding:45px 10px 45px 8%}.my-record .user-info{display:flex;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;align-items:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center}.my-record .portrait{border-radius:50%;-webkit-border-radius:50%;-moz-border-radius:50%;-ms-border-radius:50%;-o-border-radius:50%;width:60px;height:60px;object-fit:cover;-o-object-fit:cover}.my-record .portrait+strong{margin-left:15px;color:#333;font-size:20px}.my-record .info{margin:30px 0 90px;color:#333;font-size:16px}.my-record .info em{color:#49A5F8}.my-record .el-button{padding:17px 19px;font-size:16px;margin-left:-45px}.record-list .tab-nav{padding:40px 10px 0 15%;border-bottom:1px solid#E5E5E5}.record-list .tab-nav>a{display:inline-block;padding-bottom:15px;margin:0 5%;font-size:22px;color:#333}.record-list .tab-nav>a.current{color:#49A5F8;border-bottom:2px solid #49A5F8}.record-list .tab-nav>a:hover{color:#49A5F8}.record-list .tab-content{padding:30px 0}.record-list .tab-content .have-item{border:1px solid #E5E5E5;margin-bottom:20px}.record-list .tab-content .have-item .time{padding:8px 15px;color:#181818;font-size:18px;border-bottom:1px solid #E5E5E5}.record-list .tab-content .have-item .layout-box{display:flex;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;align-items:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;padding:15px 20px 15px 10px}.record-list .tab-content .have-item .layout-box .cover{width:250px;height:146px;margin-right:20px;background-repeat:no-repeat;background-position:center center;background-size:cover}.record-list .tab-content .have-item .layout-box .content{flex:1}.record-list .tab-content .have-item .layout-box .content .title{font-size:18px;color:#181818}.record-list .tab-content .have-item .layout-box .content .title:hover{color:#49A5F8}.record-list .tab-content .have-item .layout-box .content .goals{margin:12px 0;font-size:14px}.record-list .tab-content .have-item .layout-box .content .goals>span{color:#999}.record-list .tab-content .have-item .layout-box .content .goals>ul{padding-left:18px}.record-list .tab-content .have-item .layout-box .content .goals>ul li{margin-top:8px;color:#333}.record-list .tab-content .have-item .layout-box .content .foot{width:80%;display:flex;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;align-items:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;justify-content:space-between;-webkit-justify-content:space-between;-moz-justify-content:space-between;-ms-justify-content:space-between;-o-justify-content:space-between;color:#111}.record-list .tab-content .have-item .layout-box .content .foot span{margin-left:15px}.record-list .tab-content .have-item .layout-box .content .foot span em{color:#FF414A}.sort-btn{display:flex;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;padding:25px;font-size:16px;color:#333;cursor:pointer;user-select:none}.sort-btn .sort-icon{padding-right:5px}.sort-btn .sort-icon>i{display:block;line-height:8px;color:#CCC}.sort-btn .sort-icon>i.active{color:#49A5F8}.learned-record,.taughted-record{padding:45px 8%}.learned-record .item,.taughted-record .item{margin-bottom:40px;color:#111;font-size:16px;margin-right:3%}.learned-record .item>div,.taughted-record .item>div{margin-top:12px}.learned-record .item>span,.taughted-record .item>span{color:#111;font-weight:700}.learned-record .item em,.taughted-record .item em{color:#FF414A}.learnedDetails{width:100%;padding:80px 70px 60px;box-shadow:5px 4px 20px rgba(64,158,254,.44);position:relative}.learnedDetails::after,.learnedDetails::before{content:"";position:absolute;top:18px;z-index:2;width:20px;height:20px;background:#eb5a49;box-shadow:8px 4px 2px rgba(235,63,43,.44);border-radius:50%;-webkit-border-radius:50%;-moz-border-radius:50%;-ms-border-radius:50%;-o-border-radius:50%}.learnedDetails::after{left:25px}.learnedDetails::before{right:25px}.learnedDetails ul{list-style:none}.learnedDetails ul li{font-size:16px;color:#111;margin:20px 0}.learnedDetails em{color:#FF414A}.table-wrap{width:100%;margin-top:40px;border:1px solid #BFBFBF;border-radius:8px;-webkit-border-radius:8px;-moz-border-radius:8px;-ms-border-radius:8px;-o-border-radius:8px}.table-wrap td{height:50px;padding:8px 10px;text-align:center;font-size:14px}.table-wrap thead td{border-right:1px solid #BFBFBF;border-bottom:2px solid #bfbfbf;font-size:16px}.table-wrap thead td:last-child{border-right:none}.table-wrap .sort-btn{padding:0;justify-content:center;align-items:center}.table-wrap .sort-btn .sort-icon{padding-left:5px}.table-wrap tbody tr:nth-child(even){background:rgba(64,158,254,.1)}.table-wrap .user-img{width:40px;height:40px;margin:0 auto;border-radius:50%;-webkit-border-radius:50%;-moz-border-radius:50%;-ms-border-radius:50%;-o-border-radius:50%;background-size:contain;background-repeat:no-repeat;background-position:center center}.draw-user{height:30px;overflow:hidden}.draw-user::after,.draw-user::before{content:"";display:block;width:14px;height:14px;margin:0 auto;border:2px solid #49A5F8;border-radius:50%;-webkit-border-radius:50%;-moz-border-radius:50%;-ms-border-radius:50%;-o-border-radius:50%}.draw-user::after{width:24px;height:24px}.icon-more{transform:rotate(90deg);-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-ms-transform:rotate(90deg);-o-transform:rotate(90deg);font-size:24px}.taughted-record{padding:40px 5%}.taughted-record .record-operate{text-align:right;margin-right:3%}.taughted-record .record-container{margin-top:20px;padding:30px;background:rgba(121,176,255,.05)}.taughted-record .item ol{padding-left:18px}.taughted-record .item ol li{margin-top:8px;color:#333}.taughted-record .item .chartLayout{display:flex;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex}.taughted-record .item .chartLayout>div{width:50%}.taughted-record .student-info{display:flex;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex}.taughted-record .student-taughted-details .express>span{margin-right:10px;font-size:14px;color:#676767}.taughted-record .student-taughted-details .express .r::before,.taughted-record .student-taughted-details .express .w::before{content:"";width:12px;height:12px;display:inline-block;margin:0 15px;vertical-align:middle;border-radius:50%;-webkit-border-radius:50%;-moz-border-radius:50%;-ms-border-radius:50%;-o-border-radius:50%}.taughted-record .student-taughted-details .express .r::before{background-color:#27CE2F}.taughted-record .student-taughted-details .express .w::before{background-color:#F53838}.taughted-record .student-taughted-details .table-wrap{margin-top:15px}.taughted-record .student-taughted-details .table-wrap .right{color:#27CE2F}.taughted-record .student-taughted-details .table-wrap .wrong{color:#F53838}@media (max-width:992px){.taughted-record{padding:20px}.taughted-record .record-container{padding:25px}}@media (max-width:768px){.record-list .tab-content{padding:20px 0}.record-list .tab-content .have-item .layout-box .content .foot{width:100%}.sort-btn{padding:15px}.learned-record .item,.taughted-record .item{margin-bottom:25px}.learned-record .item>div,.taughted-record .item>div{margin-top:8px}.table-wrap{margin-top:25px}.table-wrap .sort-btn,.table-wrap thead td{font-size:14px}.table-wrap td{padding:8px}}.c3 svg{font:10px sans-serif;-webkit-tap-highlight-color:transparent}.c3 line,.c3 path{fill:none;stroke:#000}.c3 text{-webkit-user-select:none;-moz-user-select:none;user-select:none}.c3-bars path,.c3-event-rect,.c3-legend-item-tile,.c3-xgrid-focus,.c3-ygrid{shape-rendering:crispEdges}.c3-chart-arc path{stroke:#fff}.c3-chart-arc rect{stroke:#fff;stroke-width:1}.c3-chart-arc text{fill:#fff;font-size:13px}.c3-grid line{stroke:#aaa}.c3-grid text{fill:#aaa}.c3-xgrid,.c3-ygrid{stroke-dasharray:3 3}.c3-text.c3-empty{fill:grey;font-size:2em}.c3-line{stroke-width:1px}.c3-circle._expanded_{stroke-width:1px;stroke:#fff}.c3-selected-circle{fill:#fff;stroke-width:2px}.c3-bar{stroke-width:0}.c3-bar._expanded_{fill-opacity:1;fill-opacity:.75}.c3-target.c3-focused{opacity:1}.c3-target.c3-focused path.c3-line,.c3-target.c3-focused path.c3-step{stroke-width:2px}.c3-target.c3-defocused{opacity:.3!important}.c3-region{fill:#4682b4;fill-opacity:.1}.c3-brush .extent{fill-opacity:.1}.c3-legend-item{font-size:12px}.c3-legend-item-hidden{opacity:.15}.c3-legend-background{opacity:.75;fill:#fff;stroke:#d3d3d3;stroke-width:1}.c3-title{font:14px sans-serif}.c3-tooltip-container{z-index:10}.c3-tooltip{border-collapse:collapse;border-spacing:0;background-color:#fff;empty-cells:show;-webkit-box-shadow:7px 7px 12px -9px #777;-moz-box-shadow:7px 7px 12px -9px #777;box-shadow:7px 7px 12px -9px #777;opacity:.9}.c3-tooltip tr{border:1px solid #ccc}.c3-tooltip th{background-color:#aaa;font-size:14px;padding:2px 5px;text-align:left;color:#fff}.c3-tooltip td{font-size:13px;padding:3px 6px;background-color:#fff;border-left:1px dotted #999}.c3-tooltip td>span{display:inline-block;width:10px;height:10px;margin-right:6px}.c3-tooltip td.value{text-align:right}.c3-area{stroke-width:0;opacity:.2}.c3-chart-arcs-title{dominant-baseline:middle;font-size:1.3em}.c3-chart-arcs .c3-chart-arcs-background{fill:#e0e0e0;stroke:#fff}.c3-chart-arcs .c3-chart-arcs-gauge-unit{fill:#000;font-size:16px}.c3-chart-arcs .c3-chart-arcs-gauge-max{fill:#777}.c3-chart-arcs .c3-chart-arcs-gauge-min{fill:#777}.c3-chart-arc .c3-gauge-value{fill:#000}.c3-chart-arc.c3-target g path{opacity:1}.c3-chart-arc.c3-target.c3-focused g path{opacity:1}.noprint{display: none;}svg{height:600px;width:100%}</style>'},function(e){$(".el-message-box__wrapper , .v-modal").fadeOut(500),console.log(e)})}),$(".closeMessage").on("click",function(){$(".el-message-box__wrapper , .v-modal").fadeOut(500)}),$("#btnPrint").on("click",function(){lessonUrl&&$(".recordWrapper").append('<iframe id="keepworkContainer" frameborder="0" width="100%" src="'+KEEPWORK_HOST+lessonUrl+'?device=print"></iframe>'),$(".print-show").show(),$(".el-loading-mask").show();var e=setInterval(function(){console.log((new Date).getTime()),"ready"==$("#keepworkContainer").attr("ready")&&($(".el-loading-mask").hide(),window.print(),$("iframe").remove("#keepworkContainer"),clearInterval(e))},500)}),$("#cbxCheckAll").on("click",function(){var e=$("#cbxCheckAll").prop("checked");$("input[class='cbx-item']").prop("checked",e)}),$(".table-wrap").on("click",".cbx-item",function(){var e=0;$.each($('input[class="cbx-item"]:checked'),function(){e++}),isChecked=e===snArr.length,$("#cbxCheckAll").prop("checked",isChecked)}),$("#btnChangeAll").on("click",function(){console.log(snArr),cheatRecords(snArr)}),$("#btnChange").on("click",function(){var e=[];$.each($('input[class="cbx-item"]:checked'),function(){e.push(parseInt($(this).attr("data-sn")))}),console.log(e),cheatRecords(e)})});var lessonUrl,tblRecord=$(".record-tbl"),summary=[],snArr=[],getLessonTaughtedRecord=function(p){p=void 0===p||p,$.get(LESSON_API+"/api/class/detail",{classId:classId},function(e){var t=e.data;if(0==e.err&&(p&&tblRecord.html(""),lessonUrl=t.lessonUrl,$(".lesson-no").text(t.lessonNo),$(".lesson-title").text(t.lessonTitle),$(".lesson-time").text(fmtDate(t.startTime)),$(".lesson-goals").text(t.goals),$(".lecture-date").html("<strong> "+fmtDate(t.startTime)+"</strong>"),$(".teacher-nickname").text("Teacher: "+t.teacher+"."),$(".student-num").text(t.summary.length),t.summary instanceof Array)){summary=t.summary;var r=[],o=[],a=["Rate"],i=["Number",0,0,0];if(t.summary[0])for(var n=0;n<t.summary[0].quizNum;n++){var s="Quiz"+(n+1);r.push(s),o.push(0),a.push(0)}for(n=0;n<t.summary.length;n++){var c=t.summary[n];snArr.push(c.recordSn),c.rightCount=parseInt(c.rightCount)||0,c.wrongCount=parseInt(c.wrongCount)||0,c.emptyCount=parseInt(c.emptyCount),isNaN(c.emptyCount)&&(c.emptyCount=c.quizNum),c.accuracyRate=c.rightCount/(c.rightCount+c.emptyCount+c.wrongCount),c.accuracyRate=c.accuracyRate?Number(100*c.accuracyRate).toFixed(1):0,1===c.cheatFlag&&(c.wrongCount=0,c.emptyCount=0,c.rightCount=c.quizNum,c.accuracyRate=100),appendRecord(c),c.accuracyRate<60?i[1]+=1:60<=c.accuracyRate&&c.accuracyRate<=80?i[2]+=1:80<c.accuracyRate&&(i[3]+=1);for(var d=c.answerSheet,l=0;l<c.quizNum;l++){if(console.log(d),d)(d[l].trueFlag||1===c.cheatFlag)&&(o[l]+=1);else 1===c.cheatFlag&&(o[l]+=1)}}if(t.summary[0])for(n=0;n<t.summary[0].quizNum;n++)console.log(o),a[n+1]=o[n]/summary.length,a[n+1]=a[n+1]?Number(100*a[n+1]).toFixed(1):0;taughtedChart.load({columns:[a],categories:r}),studentChart.axis.labels({y:"Number of Students (total: "+t.summary.length+")"}),studentChart.load({columns:[i]})}})},appendRecord=function(e){tblRecord.append('<tr>    <td class="noprint"><input type="checkbox" class="cbx-item" data-sn="'+e.recordSn+'" ></td>    <td class="noprint">        <div class="user-img"><img src="'+e.portrait+'" /></div>    </td>    <td>'+e.username+"</td>    <td>"+e.studentNo+"</td>    <td>"+e.accuracyRate+"%</td>    <td>"+e.rightCount+"</td>    <td>"+e.wrongCount+"</td>    <td>"+e.emptyCount+'</td>    <td class="noprint">        <a class="noprint" target="_blank" href="/taughtedRecord/details/'+e.recordSn+"/"+e.studentNo+'" class="el-button el-button--primary el-button--mini">View Details</a>    </td></tr>')},cheatRecords=function(e){var t=e.join(",");$.post("/api/record/cheat",{sn:t},function(e){getLessonTaughtedRecord()})};